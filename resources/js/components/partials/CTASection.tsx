import { cn } from '@/lib/utils'
import { motion, useScroll, useTransform } from 'motion/react'
import { type ReactNode, useRef } from 'react'

interface CTASectionProps {
    className?: string
    children?: ReactNode
    image: string
}

const SVG_PATH = 'M0 60h1920V24.527l-6.241.874-10.065 1.781-7.995 5.008-9.877.185-8.239 4.373-8.619 2.601-8.983-1.064-9.334-.328-9.442 1.064-9.226-1.607-8.988-1.348-9.15 1.862-8.877-3.337-8.942 2.457-9.198 2.076-9.386 2.221-8.939 3.739-9.65 1.645-8.386-4.582-9.202-2.01-9.111-2.244-8.216-5.094-9.094 1.017-8.506-3.038-8.67-1.552-8.897.331-8.632.016-8.661 1.03-8.526-2.27-8.563.598-7.994 3.518-9.291-.548-7.92 4.014-8.741 1.417-7.606 5.486-8.693 2.427-8.389 3.237-8.64 3.534-9.283-2.565-8.782-3.189-9.428-.736-8.61-3.125-8.41 1.596-8.989-2.656-8.38 3.957-8.999-2.062-8.962 1.032-8.393 3.6-8.63 2.359-8.871 2.612-8.896-2.168-8.455-2.933-8.603-2.15-8.883.887-8.639.436-9.176-1.321-8.749 1.963-8.843 3.478-8.341-5.209-8.719-1.187-8.674-1.421-9.303 1.656-8.041-4.13-8.962-.828-8.2-3.231-7.836-5.19-9.062.502-8.581 3.655-8.967-1.468-8.749 3.028-8.728-1.022-8.646-.337-8.576-1.35-8.72-.147-8.518-1.814-8.011-4.223-9.004 1.257-8.04-4.216-8.758-.292-8.975 1.375-8.291-3.231-8.619.536-8.382.99-8.991-2.321-8.441 2.405-8.55 1.913-8.786-1.476-8.786 2.215-8.742-.688-9.082-2.915-8.7 3.871-7.3 6.178-8.93 2.47-9.05 2.204-7.717 4.716-8.649-2.42-9.32.602-8.808-2.679-9.199-.166-8.976-1.592-9.057-2.168-9.221.673-9.127-.827-9.193.259-8.855-2.146-7.77-2.055-7.629-3.196-7.827-2.567-8.188-1.464-7.868-2.744-8.342-1.605-8.366-.568-8.33-.835-8.514.78-8.266-1.8-7.789 3.649-8.042 2.39-8.681-.317-7.97 2.682-8.117 2.296-8.103 1.711-8.437-3.069-7.871 3.747-8.217-.446-7.178 3.429-7.54 2.46-7.505 2.536-7.389 4.1-10.074-3.412-9.963-1.957-10.092.17-7.936 1.273-7.67 3.283-8.37.535-7.97 2.887-10.229-1.907-9.939-2.773-10.525 1.003-8.311-3.019-8.823.042-8.3-2.924-8.358-2.88-8.798.007-8.628-1.544-8.797.675-8.652-2.441-8.833.114-8.615 2.71-8.807-1.546-8.542 3.553-8.849-1.36-8.614 1.816-8.783-.28-8.684.293-8.738-.514-8.818.017-8.813.017-8.622 1.311-9.216-1.565-8.663 1.929-8.627 2.056-8.184 4.481-8.933-1.109-8.866-.709-8.546-3.309-8.969.012-8.87-.253-8.654 1.826-8.792.283-8.614.274-8.429-1.952-8.763-1.097-9.213 1.499-8.366-4.481-8.784 4.161-9.46-2.116-9.019 1.009-8.782 3.677-8.38-3.648-8.3-3.508-7.856-4.501-8.538-2.571-9.2-2.349-9.381-.635-9.418 1.931-9.245.393-7.043 3.929-8.86.192-6.048 6.626-8.806.308-7.129 3.728-8.084-.767-8.138 3.529-8.241-.602-8.329-1.933-7.946.476-7.64 3.118-8.083-1.576-7.72 2.161-9.356-.918-9.149 3.486-9.42-2.235-9.239.977-9.28.383-9.34 2.055-9.291-.182-9.391-.827-9.279-1.877-9.327-1.025-8.989-2.788-8.758-3.816-9.673.161-9.053-2.451-9.283-1.524-8.831-2.619-9.111-.038-9.252-1.534-9.235-1.992-9.411 3.042-9.613-2.835L.75 26.104 0 26.21V60z'

export default function CTASection({
    className,
    children,
    image,
}: CTASectionProps) {
    const container = useRef<HTMLElement>(null)
    const { scrollYProgress } = useScroll({
        target: container,
        offset: ['start end', 'end start'],
    })
    const y = useTransform(scrollYProgress, [0, 1], ['-5%', '5%'])

    return (
        <section
            ref={container}
            className="relative flex h-[526px] items-center justify-center overflow-hidden py-[calc(100%_*_60_/_1920)]"
            style={{ clipPath: 'polygon(0% 0, 100% 0%, 100% 99.5%, 0 99.5%)' }}
        >
            <div className="-top-px absolute left-0 z-20 w-full overflow-hidden">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 1920 60"
                    aria-hidden="true"
                    className="relative left-[-1%] block h-auto w-[102%] max-w-none rotate-180"
                >
                    <path className="fill-background" d={SVG_PATH} />
                </svg>
            </div>

            <div className={cn('container relative z-10 size-full', className)}>
                {children}
            </div>

            <div className="fixed top-[-5vh] left-0 h-[120vh] w-full">
                <motion.div
                    style={{ y }}
                    className="relative size-full before:absolute before:inset-0 before:z-[5] before:bg-black/20"
                >
                    <img
                        src={image}
                        alt="image"
                        className="absolute inset-0 size-full object-cover"
                    />
                </motion.div>
            </div>

            <div className='-bottom-px absolute left-0 z-20 w-full overflow-hidden'>
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 1920 60"
                    aria-hidden="true"
                    className='relative left-[-1%] block h-auto w-[102%] max-w-none'
                >
                    <path className="fill-background" d={SVG_PATH} />
                </svg>
            </div>
        </section>
    )
}
